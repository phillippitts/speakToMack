spring.application.name=speakToMack

# Web server configuration
# Note: This is a desktop app (hotkey-driven), but we keep the web server for:
# - Actuator endpoints (health, metrics, prometheus) for monitoring
# - Local management/debugging via HTTP
server.port=8080

# Audio Validation
audio.validation.min-duration-ms=250
audio.validation.max-duration-ms=300000

# STT Engine Configuration - Vosk (fast, JNI-based)
stt.vosk.model-path=models/vosk-model-en-us-0.22
stt.vosk.sample-rate=16000
stt.vosk.max-alternatives=1

# STT Engine Configuration - Whisper (accurate, process-based)
stt.whisper.binary-path=tools/whisper.cpp/main
stt.whisper.model-path=models/ggml-base.en.bin
stt.whisper.timeout-seconds=10
stt.whisper.language=en
stt.whisper.threads=4
stt.whisper.max-stdout-bytes=1048576
# Output mode for whisper stdout: text | json
# When set to "json", enables pause detection using segment timestamps
# Required for automatic paragraph breaks (see stt.orchestration.silence-gap-ms)
stt.whisper.output=json

# STT Orchestration
stt.enabled-engines=vosk,whisper
stt.parallel.timeout-ms=10000
stt.orchestration.primary-engine=vosk
# Automatic paragraph breaks: insert newline when silence WITHIN audio exceeds this threshold (ms)
# Vosk: Uses Voice Activity Detection (VAD) to detect silence in PCM audio
# Whisper: Uses segment timestamps from JSON output (requires stt.whisper.output=json)
# Set to 0 to disable. Default: 1000 (1 second)
stt.orchestration.silence-gap-ms=1000

# STT Reconciliation (Phase 4) - Smart reconciliation based on confidence
stt.reconciliation.enabled=true
stt.reconciliation.strategy=word-overlap
stt.reconciliation.overlap-threshold=0.6
# If Vosk confidence < this threshold, run Whisper too and reconcile (0.0-1.0)
# Lower = more dual-engine (better accuracy, more resources)
# Higher = more single-engine (faster, fewer resources)
# Recommended: 0.7 (upgrade to dual-engine when Vosk is uncertain)
stt.reconciliation.confidence-threshold=0.7

# STT Concurrency caps (lightweight bulkheads)
stt.concurrency.vosk-max=4
stt.concurrency.whisper-max=2
stt.concurrency.acquire-timeout-ms=1000

# Thread Pool Configuration
# STT Executor Pool (for parallel STT engine processing)
# Defaults align with CPU count - adjust based on your hardware
threadpool.stt.core-pool-size=2
threadpool.stt.max-pool-size=4
threadpool.stt.queue-capacity=10
threadpool.stt.keep-alive-seconds=60
threadpool.stt.thread-name-prefix=stt-pool-

# Event Executor Pool (for offloading event listener work)
threadpool.event.core-pool-size=2
threadpool.event.max-pool-size=4
threadpool.event.queue-capacity=10
threadpool.event.keep-alive-seconds=60
threadpool.event.thread-name-prefix=event-pool-

# STT Engine Watchdog (auto-restart with sliding window budget)
stt.watchdog.enabled=true
stt.watchdog.window-minutes=60
stt.watchdog.max-restarts-per-window=3
stt.watchdog.cooldown-minutes=10

# Fail-fast model validation (disable only for special test profiles)
stt.validation.enabled=true

# Audio capture defaults
audio.capture.chunk-millis=40
audio.capture.max-duration-ms=600000
# audio.capture.device-name=

# Spring Boot Actuator - Production monitoring and health checks
management.endpoints.web.exposure.include=health,info,metrics,prometheus
management.endpoints.web.base-path=/actuator
management.endpoint.health.show-details=always
management.health.defaults.enabled=true


# Graceful shutdown - wait up to 30s for requests to complete
server.shutdown=graceful
spring.lifecycle.timeout-per-shutdown-phase=30s

# Hotkey defaults (Task 3.2/3.3)
hotkey.type=modifier-combo
hotkey.key=J
hotkey.modifiers=META,CONTROL
# hotkey.threshold-ms=300
# Reserved OS shortcuts to warn about (platform-aware; adjust as needed)
# macOS: META+TAB (Cmd+Tab), Windows: META+L (Win+L)
# hotkey.reserved=META+TAB,META+L
# Toggle mode: if true, first press starts recording, second press stops and transcribes.
# If false (default), uses push-to-talk: press starts recording, release stops and transcribes.
hotkey.toggle-mode=true

# Typing / Fallback defaults (Task 3.4)
typing.chunk-size=800
typing.inter-chunk-delay-ms=30
typing.focus-delay-ms=100
typing.restore-clipboard=true
typing.clipboard-only-fallback=false
typing.normalize-newlines=LF
typing.trim-trailing-newline=true
typing.enable-robot=true
# typing.paste-shortcut=os-default
